generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String    @id @default(uuid())
  userId           String    @unique @default(nanoid(15))
  stripeCustomerId String?   @unique
  name             String
  email            String
  password         String?
  role             String    @default("client")
  image            String?
  company          String?
  designation      String?
  phoneNumber      String?
  paymentStatus    String?

  orders           Order[]
  payment          PaymentMethod[]
  adminAssignments AdminAssignment[] @relation("AdminAssignments")
  userAssignments  AdminAssignment[] @relation("UserAssignments")

  chatParticipants ChatParticipant[]
  chatMessages     ChatMessage[]
  userChatRooms    ChatRoom[] @relation("UserChatRooms")  // Fixed relation
  adminChatRooms   ChatRoom[] @relation("AdminChatRooms") // Fixed relation

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  notifications Notification[]
}

model Order {
  id               String   @id @default(uuid())
  orderId          String   @unique @default(nanoid(15))
  detailsSubmitted String?  @default("not-yet")
  status           String   @default("pending")
  publicationId    String
  methodId         String
  paymentMethodId  String?
  orderType        String   @default("wonArticle")
  amount           Int

  // Optional fields for different article types
  wonArticleId   String?
  writeArticleId String?

  userId       String?
  user         User?            @relation(fields: [userId], references: [id])
  publication  Publication?      @relation(fields: [publicationId], references: [id])
  wonArticle   WonArticle?     @relation(fields: [wonArticleId], references: [id])
  writeArticle WriteArticle?   @relation(fields: [writeArticleId], references: [id])
  paymentMethod       PaymentMethod?   @relation(fields: [paymentMethodId], references: [id])
  adminAssignments AdminAssignment[] @relation("OrderAdminAssignments")
  chatRoom         ChatRoom?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  @@map("orders")
  notifications Notification[]
}

model PaymentMethod {
  id                    String   @id @default(uuid())
  userId                String
  stripePaymentMethodId String   @unique
  type                  String  
  brand                 String
  last4                 String
  expMonth              Int?
  expYear               Int?
  isDefault             Boolean  @default(false)
  
  // Billing details
  email                 String?
  name                  String?
  phone                 String?
  billingAddress        String?
  
  createdAt             DateTime @default(now())
  
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  order                  Order[]
  
  @@map("payment_methods")
}

// model Service {
//   id     String  @id @default(uuid())
//   name   String
//   orders Order[] @relation("OrderToService")

//   @@map("services")
// }

model WonArticle {
  id        String   @id @default(uuid())
  file      String
  message   String?
  orders    Order[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("won_articles")
}

model WriteArticle {
  id                String   @id @default(uuid())
  fullName          String
  designation       String
  company           String
  socialMediaLink   String?
  blockContentLink  String?
  additionalLink    String?
  mainGoal          String
  mainTheme         String
  points            String
  audience          String
  wishList          String
  announcement      String?
  additionalContent String?
  service           String   @default("won-article")
  personImage       String
  serviceImage      String?
  brandLogo         String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  orders            Order[]

  @@map("write_articles")
}

model Publication {
  id            String   @id @default(uuid())
  publicationId String   @unique @default(nanoid(15))
  title         String
  logo          String?
  scope         String?
  region        String?
  state         String?
  city          String?
  da            String?
  dr            String?
  tat           String?
  ttp           String?
  favorite      String[]
  price         String
  location      String?
  index         String
  // nicheId   String?
  sponsor       String
  doFollow      String
  niches        String[] @default([])
  // genreId   String[]
  genre         String
  orders        Order[]
  favorites     Favorite[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("publications")
}

model Favorite {
  id        String   @id @default(uuid())
  userId    String
  publicationId String
  publication Publication @relation(fields: [publicationId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("favorites")
}

model Niche {
  id        String   @id @default(uuid())
  title     String
  icon      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("niches")
}

model Genre {
  id        String   @id @default(uuid())
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("genres")
}

model Indexed {
  id        String   @id @default(uuid())
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("indexes")
}

model Sponsored {
  id        String   @id @default(uuid())
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("sponsors")
}

model DoFollow {
  id        String   @id @default(uuid())
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("dofollows")
}


model Notification {
  id           String   @id @default(uuid())
  title        String
  message      String
  type         String 
  status       String   @default("unread")
  recipientId  String   
  orderId      String?  
  order        Order?   @relation(fields: [orderId], references: [id])
  userId       String  
  user         User?    @relation(fields: [userId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("notifications")
  @@index([recipientId, status])
  @@index([createdAt])
}

model ChatRoom {
  id        String   @id @default(uuid())
  roomId    String   @unique @default(nanoid(15))
  orderId   String?  @unique
  userId    String
  adminId   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt // Fixed: added @updatedAt

  // Relations
  order       Order?             @relation(fields: [orderId], references: [id])
  user        User               @relation("UserChatRooms", fields: [userId], references: [id])
  admin       User               @relation("AdminChatRooms", fields: [adminId], references: [id])
  participants ChatParticipant[]
  messages    ChatMessage[]

  @@map("chat_rooms")
}

model ChatParticipant {
  id         String   @id @default(uuid())
  userId     String
  chatRoomId String
  joinedAt   DateTime @default(now())

  // Relations
  user     User     @relation(fields: [userId], references: [id])
  chatRoom ChatRoom @relation(fields: [chatRoomId], references: [id])

  @@unique([userId, chatRoomId])
  @@map("chat_participants")
}

model ChatMessage {
  id          String   @id @default(uuid())
  messageId   String   @unique @default(nanoid(15))
  content     String
  senderId    String
  chatRoomId  String
  messageType String   @default("text") // text, image, file, etc.
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  sender   User     @relation(fields: [senderId], references: [id])
  chatRoom ChatRoom @relation(fields: [chatRoomId], references: [id])

  @@map("chat_messages")
}

model AdminAssignment {
  id        String   @id @default(uuid())
  adminId   String
  userId    String?
  orderId   String?
  assignedAt DateTime @default(now())

  admin User  @relation("AdminAssignments", fields: [adminId], references: [id])
  user  User? @relation("UserAssignments", fields: [userId], references: [id])
  order Order? @relation("OrderAdminAssignments", fields: [orderId], references: [id])

  @@map("admin_assignments")
}