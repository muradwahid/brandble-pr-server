generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String            @id @default(uuid())
  userId           String            @unique @default(nanoid(15))
  stripeCustomerId String?           @unique
  name             String
  email            String            @unique
  password         String?
  role             String            @default("client")
  image            String?
  company          String?
  designation      String?
  phoneNumber      String?
  paymentStatus    String?
  otp              String?
  otpExpires       DateTime?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  adminAssignments AdminAssignment[] @relation("AdminAssignments")
  userAssignments  AdminAssignment[] @relation("UserAssignments")
  chatMessages     ChatMessage[]
  chatParticipants ChatParticipant[]
  adminChatRooms   ChatRoom[]        @relation("AdminChatRooms")
  userChatRooms    ChatRoom[]        @relation("UserChatRooms")
  notifications    Notification[]
  orders           Order[]
  payment          PaymentMethod[]
}

model Order {
  id               String            @id @default(uuid())
  orderId          String            @unique @default(nanoid(15))
  detailsSubmitted String?           @default("not-yet")
  status           String            @default("pending")
  publicationId    String
  methodId         String?
  paymentMethodId  String?
  // orderType        String            @default("wonArticle")
  paymentStatus     String           @default("pending")
  orderType        String            @default("")
  amount           Int
  wonArticleId     String?
  writeArticleId   String?
  userId           String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  adminAssignments AdminAssignment[] @relation("OrderAdminAssignments")
  chatRoom         ChatRoom?
  notifications    Notification[]
  paymentMethod    PaymentMethod?    @relation(fields: [paymentMethodId], references: [id])
  publication      Publication       @relation(fields: [publicationId], references: [id])
  user             User?             @relation(fields: [userId], references: [id])
  wonArticle       WonArticle?       @relation(fields: [wonArticleId], references: [id])
  writeArticle     WriteArticle?     @relation(fields: [writeArticleId], references: [id])

  @@map("orders")
}

model PaymentMethod {
  id                    String   @id @default(uuid())
  userId                String
  stripePaymentMethodId String   @unique
  type                  String
  brand                 String
  last4                 String
  expMonth              Int?
  expYear               Int?
  isDefault             Boolean  @default(false)
  email                 String?
  name                  String?
  phone                 String?
  billingAddress        String?
  createdAt             DateTime @default(now())
  order                 Order[]
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("payment_methods")
}

model WonArticle {
  id        String   @id @default(uuid())
  file      String
  message   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  orders    Order[]

  @@map("won_articles")
}

model WriteArticle {
  id                String   @id @default(uuid())
  fullName          String
  designation       String
  company           String
  socialMediaLink   String?
  blockContentLink  String?
  additionalLink    String?
  mainGoal          String
  mainTheme         String
  points            String
  audience          String
  wishList          String
  announcement      String?
  additionalContent String?
  service           String   @default("won-article")
  personImage       String
  serviceImage      String?
  brandLogo         String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  orders            Order[]

  @@map("write_articles")
}

model Publication {
  id            String     @id @default(uuid())
  publicationId String     @unique @default(nanoid(15))
  title         String
  logo          String?
  scope         String?
  da            String?
  dr            String?
  tat           String?
  ttp           String?
  favorite      String[]
  price         Float?
  location      String?
  index         String?
  sponsor       String?
  doFollow      String?
  genre         String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  favorites     Favorite[]
  orders        Order[]
  cities        City[]     @relation("PublicationCities")
  countries     Country[]  @relation("PublicationCountries")
  niches        Niche[]    @relation("PublicationNiches")
  states        State[]    @relation("PublicationStates")

  @@map("publications")
}

model Country {
  id           String        @id @default(uuid())
  name         String
  code         String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  states       State[]
  publications Publication[] @relation("PublicationCountries")

  @@map("countries")
}

model State {
  id           String        @id @default(uuid())
  name         String
  countryId    String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  cities       City[]
  country      Country?      @relation(fields: [countryId], references: [id])
  publications Publication[] @relation("PublicationStates")

  @@map("states")
}

model City {
  id           String        @id @default(uuid())
  name         String
  stateId      String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  state        State?        @relation(fields: [stateId], references: [id])
  publications Publication[] @relation("PublicationCities")

  @@map("cities")
}

model Favorite {
  id            String      @id @default(uuid())
  userId        String
  publicationId String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  publication   Publication @relation(fields: [publicationId], references: [id])

  @@map("favorites")
}

model Niche {
  id           String        @id @default(uuid())
  title        String
  icon         String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  publications Publication[] @relation("PublicationNiches")

  @@map("niches")
}

model Genre {
  id        String   @id @default(uuid())
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("genres")
}

model Indexed {
  id        String   @id @default(uuid())
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("indexes")
}

model Sponsored {
  id        String   @id @default(uuid())
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("sponsors")
}

model DoFollow {
  id        String   @id @default(uuid())
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("dofollows")
}

model Notification {
  id          String   @id @default(uuid())
  title       String
  message     String
  type        String
  status      String   @default("unread")
  recipientId String
  orderId     String?
  userId      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  order       Order?   @relation(fields: [orderId], references: [id])
  user        User     @relation(fields: [userId], references: [id])

  @@index([recipientId, status])
  @@index([createdAt])
  @@map("notifications")
}

model ChatRoom {
  id           String            @id @default(uuid())
  roomId       String            @unique @default(nanoid(15))
  orderId      String?           @unique
  userId       String
  adminId      String
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  messages     ChatMessage[]
  participants ChatParticipant[]
  admin        User              @relation("AdminChatRooms", fields: [adminId], references: [id])
  order        Order?            @relation(fields: [orderId], references: [id])
  user         User              @relation("UserChatRooms", fields: [userId], references: [id])

  @@map("chat_rooms")
}

model ChatParticipant {
  id         String   @id @default(uuid())
  userId     String
  chatRoomId String
  joinedAt   DateTime @default(now())
  chatRoom   ChatRoom @relation(fields: [chatRoomId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@unique([userId, chatRoomId])
  @@map("chat_participants")
}

model ChatMessage {
  id          String   @id @default(uuid())
  messageId   String   @unique @default(nanoid(15))
  content     String
  senderId    String
  chatRoomId  String
  messageType String   @default("text")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  chatRoom    ChatRoom @relation(fields: [chatRoomId], references: [id])
  sender      User     @relation(fields: [senderId], references: [id])

  @@map("chat_messages")
}

model AdminAssignment {
  id         String   @id @default(uuid())
  adminId    String
  userId     String?
  orderId    String?
  assignedAt DateTime @default(now())
  admin      User     @relation("AdminAssignments", fields: [adminId], references: [id])
  order      Order?   @relation("OrderAdminAssignments", fields: [orderId], references: [id])
  user       User?    @relation("UserAssignments", fields: [userId], references: [id])

  @@map("admin_assignments")
}
